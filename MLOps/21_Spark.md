- UC ë²„í´ë¦¬ ëŒ€í•™êµì—ì„œ 2009ë…„ ìŠ¤íŒŒí¬ ì—°êµ¬ ì‹œì‘ â†’ 2013ë…„ ì•„íŒŒì¹˜ ì¬ë‹¨ì— ê¸°ë¶€
- í´ëŸ¬ìŠ¤í„° í™˜ê²½ì—ì„œ ë°ì´í„°ë¥¼ ë³‘ë ¬ë¡œ ì²˜ë¦¬í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ ì§‘í•©
    - HDFSì™€ MapReduce ì²˜ë¦¬ ì—”ì§„ìœ¼ë¡œ êµ¬ì„±
    - í•˜ë‘¡ê³¼ ìœ ì‚¬í•˜ì§€ë§Œ ëŒ€ëŸ‰ì˜ ë°ì´í„°ë¥¼ ë©”ëª¨ë¦¬ì— ìœ ì§€í•˜ëŠ” ì„¤ê³„ë¡œ ë¹ ë¥¸ ì†ë„ ì²˜ë¦¬
- ì–¸ì–´ì§€ì›
    - SQL
    - Python
    - Java
    - R
    - ìŠ¤ì¹¼ë¼
        - ìŠ¤íŒŒí¬ì˜ Original Language
        - Functional Programing Javaì¸ ëŠë‚Œ
- OLTP(ì˜¨ë¼ì¸ íŠ¸ëœì­ì…˜ ì²˜ë¦¬) ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì—¼ë‘ì— ë‘ê³  ì„¤ê³„ë˜ì§€ ì•ŠìŒ
- ì¼ê´„ì²˜ë¦¬, ë°ì´í„° ë§ˆì´ë‹ ê°™ì€ ì˜¨ë¼ì¸ ë¶„ì„ì²˜ë¦¬ ì‘ì—…(OL:AP)ì— ì í•©
    - OLTP (Online Transaction Processing)
        - 1ê°œì˜ ìš”ì²­ ì‘ì—…ì„ ì²˜ë¦¬í•˜ëŠ” ê³¼ì •
        - ë³µìˆ˜ì˜ ì‚¬ìš©ì PCì—ì„œ ë°œìƒë˜ëŠ” íŠ¸ëœì­ì…˜ì„ DBì„œë²„ê°€ ì²˜ë¦¬í•˜ê³ , ê·¸ ê²°ê³¼ë¥¼ ìš”ì²­í•œ ì‚¬ìš©ì PCì— ê²°ê³¼ê°’ì„ ë˜ëŒë ¤ì£¼ëŠ” ê³¼ì •
        - ë‹¨ê³„ì  ì²˜ë¦¬ê°€ ë‹¤ ì™„ë£Œë˜ì–´ì•¼ 1ê°œì˜ ìš”ì²­ì‘ì—…ì´ ì™„ë²½í•˜ê²Œ ì²˜ë¦¬ë¨
        - ê° ì‘ì—…ìš”ì²­ì„ ì˜¤ë¥˜ì—†ì´ ì²˜ë¦¬í•˜ê³ , ê·¸ ê²°ê³¼ê°’ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸ì‹œì¼œì£¼ì–´ì•¼ í•¨
        - 1ê°œì˜ íŠ¸ëœì­ì…˜ì—ì„œ ë°œìƒë˜ëŠ” INSERT, UPDATE, DELETE ê³¼ì •ì˜ ë¬´ê²°ì„±ì„ ë³´ì¥í•˜ì—¬ ì²˜ë¦¬í•˜ê³  ê·¸ ê²°ê³¼ëŠ” SELECT í•˜ëŠ” ê³¼ì •
    - OLAP (Online Analytical Processing)
        - ì´ë¯¸ ì €ì¥ëœ ë°ì´í„°ë¥¼ ê¸°ë°˜í•˜ì—¬ ë¶„ì„í•˜ëŠ”ë° ì¤‘ì 
        - ë°ì´í„° ì›¨ì–´í•˜ìš°ìŠ¤(DW) (= DBì— ì €ì¥ë˜ì–´ ìˆëŠ” ë°ì´í„°)ì˜ ë°ì´í„°ë¥¼ ë¶„ì„í•˜ê³ , ë°ì´í„° ë¶„ì„ì„ í†µí•´ ì‚¬ìš©ìì—ê²Œ ìœ ì˜ë¯¸í•œ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ëŠ” ì²˜ë¦¬ë°©ë²•
        - ê¸°ì¡´ì— ì €ì¥ë˜ì–´ ìˆëŠ” ë°ì´í„°ë¥¼ ì‚¬ìš©ìì˜ ìš”êµ¬ì™€ ëª©ì ì— ë§ê²Œ ë¶„ì„í•˜ì—¬ ì •ë³´ë¥¼ ì œê³µ
        - 1ë…„ë™ì•ˆì˜ ë²Œì–´ë“¤ì¸ ê¸ˆì•¡ê³¼ ì§€ì¶œí•­ëª©ë³„ ê¸ˆì•¡ ì •ë¦¬
    
    ![1](./img/spark2.png)
    
- ì†ë„ ë¹ ë¥´ë©° ë³‘ë ¬ì²˜ë¦¬
- RDD (Resilient Distrubuted Dataset)
    - ë¶„ì‚° ë³€ê²½ ë¶ˆê°€ëŠ¥í•œ ê°ì²´ëª¨ìŒ
    - ìŠ¤íŒŒí¬ì˜ ëª¨ë“  ì‘ì—…ì€ ìƒˆë¡œìš´ RDDë¥¼ ë§Œë“¤ê±°ë‚˜ ì¡´ì¬í•˜ëŠ” RDDë¥¼ ë³€í˜•í•˜ê±°ë‚˜ ê²°ê³¼ ê³„ì‚°ì„ ìœ„í•´ RDDì—ì„œ ì—°ì‚°í•˜ëŠ” ê²ƒì„ í‘œí˜„
    - ë¹ ë¥¸ MapReduceì‘ì—…ì„ RDD ê°œë…ì„ ì´ìš©í•´ ì‚¬ìš©
        - Hadoopì˜ MapReduce ë‹¨ì ìœ¼ë¡œ ì¸í•´ Spark RDDë¡œ ë„˜ì–´ì™”ë‹¤.
    - Spark RDDë¥¼ ì´ìš©í•œ ë°ì´í„° ê³µìœ 
        - ë©”ëª¨ë¦¬ ë‚´ ì²˜ë¦¬ ì—°ì‚° ì§€ì›
        - ë©”ëª¨ë¦¬ì—ì„œ ë°ì´í„° ê³µìœ ëŠ” ë„¤íŠ¸ì›Œí¬ë‚˜ ë””ìŠ¤í¬ë³´ë‹¤ 10 ~ 100ë°° ë¹ ë¥¸ë°, ë°ì´í„°ë¥¼ ë¨ì— ì˜¬ë¦° í›„ì— fault-tolerantê°€ ë°œìƒí•´ë„ ë¬¸ì œê°€ ì—†ë„ë¡ memory ë‚´ìš©ì„ ê°±ì‹ í•˜ì§€ ì•Šê³  readi-onlyë¡œ ì‚¬ìš©í•˜ëŠ” ë°©ë²•
        - Hadoopì˜ êµ¬ì¡°ì™€ ë™ì¼í•˜ì§€ë§Œ hdfsì— ì ‘ê·¼í•˜ëŠ” ê²ƒì´ ì•„ë‹Œ memoryì— ë³´ê´€í•˜ì—¬ ì‹¤í–‰ì‹œê°„ì„ ì¤„ì—¬ì¤€ë‹¤.
        
        ![2](./img/spark3.png)
        
- GraphX : ìë£Œêµ¬ì¡° ê·¸ë˜í”„ì™€ ë™ì¼

---

1. í•˜ë‘¡ê³¼ ìŠ¤íŒŒí¬ëŠ” ë‹¤ë¥´ë‹¤
    1. í•˜ë‘¡ : ë¶„ì‚° ë°ì´í„° ì¸í”„ë¼
    2. ìŠ¤íŒŒí¬ : ë¶„ì‚°ëœ ë°ì´í„° ì²˜ë¦¬ ë„êµ¬
2. ì„œë¡œ í•„ìš”ëŠ” ì—†ë‹¤
    1. í•˜ë‘¡ : HDFSì™€ MapReduceë¼ëŠ” ìì²´ ë°ì´í„° ì²˜ë¦¬ ë„êµ¬ê°€ í¬í•¨
    2. ìŠ¤íŒŒí¬ : í•˜ë‘¡ê³¼ ê°€ì¥ ì˜ ë™ì‘í•˜ì§€ë§Œ, êµ³ì´ í•˜ë‘¡ì´ í•„ìš”í•˜ì§€ëŠ” ì•ŠìŒ
3. ì†ë„
    1. í•˜ë‘¡ : ë§µë¦¬ë“€ìŠ¤ë¥¼ ë°°ì¹˜ë°©ì‹ì´ë¼ ëŠ¦ìŒ
    2. ìŠ¤íŒŒí¬ : ì¸ë©”ëª¨ë¦¬ ì²˜ë¦¬ë°©ì‹ì´ë¼ ë°°ì¹˜ëŠ” 10ë°°, ì¸ë©”ëª¨ë¦¬ ë¶„ì„ì—ëŠ” 100ë°° ë¹ ë¦„
4. ëª¨ë“  ì‘ì—…ì— ì†ë„ê°€ ì¤‘ìš”í•œê°€
    1. í•˜ë‘¡ : ì •ì ì´ë©° ë°°ì¹˜í˜•íƒœ ì‘ì—…ì— ì í•©
    2. ìŠ¤íŒŒí¬ : ì‹¤ì‹œê°„ IoT ì„¼ì„œ, ê¸°ê³„í•™ìŠµ, ì‹¤ì‹œê°„ ë§ˆì¼€íŒ…, ì˜¨ë¼ì¸ ì¶”ì²œ ë“±ì— ì í•©
5. ì¥ì•  ë³µêµ¬ ëŠ¥ë ¥
    1. í•˜ë‘¡ : íƒœìƒì ìœ¼ë¡œ ì‹œìŠ¤í…œ ì¥ì• ì— ë‚´ì„±ì´ ê°•í•¨
    2. ìŠ¤íŒŒí¬ : RDDë¡œ ì¥ì•  ë³µêµ¬ ëŠ¥ë ¥ì„ ê¸°ë³¸ ì œê³µ

---

- sc : ìŠ¤íŒŒí¬ ì„¸ì…˜ì„ ì—´ì–´ì„œ ì—°ê²°í•´ì•¼ ìŠ¤íŒŒí¬ UIë¥¼ ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤

### ìŠ¤íŒŒí¬ì˜ ë¶„ì‚° ì‹¤í–‰ì˜ ì´í•´

- ìŠ¤íŒŒí¬ ë“œë¼ì´ë²„
    - SparkSession ê°ì²´ë¥¼ ì´ˆê¸°í™”
    - í´ëŸ¬ìŠ¤í„°ì˜ ë¶„ì‚° ì»´í¬ë„ŒíŠ¸(Spark executor)ì— ì ‘ê·¼
    - í´ëŸ¬ìŠ¤í„° ë§¤ë‹ˆì €ì™€ í†µì‹ í•´ Spark executorë“¤ì„ ìœ„í•´ í•„ìš”í•œ ìì›ì„ ìš”ì²­(CPU, ë©”ëª¨ë¦¬ ë“±) ëª¨ë“  ìŠ¤íŒŒí¬ ì‘ì—…ì€ DAG ì—°ì‚° í˜•íƒœë¡œ ë³€í™˜

### SparkSession

- ëª¨ë“  ìŠ¤íŒŒí¬ ì—°ì‚°ê³¼ ë°ì´í„°ì— ëŒ€í•œ í†µí•© ì—°ê²° ì±„ë„ì´ ë¨
- SparkContext, SQLContext, HiveContext, SparkConf, StreamingContext ë“±ì„ í†µí•©
- JVM ì‹¤í–‰

### ë¶„ì‚° ë°ì´í„°

- HDFSë‚˜ í´ë¼ìš°ë“œ ì €ì¥ì†Œì— ì¡´ì¬í•˜ëŠ” íŒŒí‹°ì…˜ì´ ë˜ì–´ ì €ì¥ì†Œ ì „ì²´ì— ë¶„ì‚°
- ë„¤íŠ¸ì›Œí¬ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ íŒŒí‹°ì…˜ì„ ì½ë„ë¡ í…ŒìŠ¤í¬ í• ë‹¹
    - ì²­í¬ë‚˜ íŒŒí‹°ì…˜ìœ¼ë¡œ ë¶„ì‚°í•´ ì €ì¥í•˜ëŠ” ë°©ì‹ = Spark executor
- ìŠ¤íŒŒí¬ ì½”ì–´ ê¸°ëŠ¥ë“¤ê³¼ ìƒí˜¸ì‘ìš©í•  ìˆ˜ ìˆëŠ” ì§„ì…ì  ì œê³µ
- ê·¸ APIë¡œ í”„ë¡œê·¸ë˜ë° í•  ìˆ˜ ìˆê²Œ í•´ì£¼ëŠ” ê°ì²´
- ì¡(Job)
    - ì—¬í–‰ ê³„íš
- ìŠ¤í…Œì´ì§€
- íƒœìŠ¤í¬
- ì•¡ì…˜
- ëª¨ë“  ìŠ¤íŒŒí¬ ì—°ì‚°ì´ í•˜ë‚˜ì˜ ìŠ¤í…Œì´ì§€ ì•ˆì—ì„œ ì‹¤í–‰ë  ìˆ˜ ì—†ìœ¼ë¯€ë¡œ ì—¬ëŸ¬ ìŠ¤í…Œì´ì§€ë¡œ ë‚˜ëˆ ì–´ì•¼ í•¨

### ìŠ¤íŒŒí¬ íƒœìŠ¤í¬

- ìŠ¤íŒŒí¬ì—ì„œ ìµœì†Œ ì‹¤í–‰ë‹¨ìœ„
- ê° íƒœìŠ¤í¬ëŠ” ê°œë³„ CPU ì½”ì–´ì— í• ë‹¹ë˜ê³  ê°œë³„ íŒŒí‹°ì…˜ì„ ê°–ê³  ì‘ì—…

### â­Partition

- RDDë‚˜ Datasetì„ êµ¬ì„±í•˜ê³  ìˆëŠ” ìµœì†Œ ë‹¨ìœ„ ê°ì²´
- ê° Partitionì€ ì„œë¡œ ë‹¤ë¥¸ ë…¸ë“œì—ì„œ ë¶„ì‚°ì²˜ë¦¬ ë¨
    - 1 Core = 1 Task = 1Partition
- Sparkì—ì„œ í•˜ë‚˜ì˜ ìµœì†Œ ì—°ì‚°ì„ Task â†’ í•˜ë‚˜ì˜ Taskì—ì„œ í•˜ë‚˜ì˜ Partition ì²˜ë¦¬ â†’ í•˜ë‚˜ì˜ TaskëŠ” í•˜ë‚˜ì˜ Coreê°€ ì—°ì‚° ì²˜ë¦¬
- Partition ìˆ˜ì— ë”°ë¼ ê° Partitionì˜ í¬ê¸°ê°€ ê²°ì •ë¨
    - Partitionì˜ í¬ê¸°ëŠ” Coreë‹¹ í•„ìš”í•œ ë©”ëª¨ë¦¬ í¬ê¸°ë¥¼ ê²½ì •
    - Partition ìˆ˜ â†’ Core ìˆ˜
    - Partition í¬ê¸° â†’ ë©”ëª¨ë¦¬ í¬ê¸°
- Paritionì˜ ìˆ˜ë¥¼ ëŠ˜ë¦¬ëŠ” ê²ƒì€ Task ë‹¹ í•„ìš”í•œ ë©”ëª¨ë¦¬ë¥¼ ì¤„ì´ê³  ë³‘ë ¬í™”ì˜ ì •ë„ë¥¼ ëŠ˜ë¦°ë‹¤.
- ë³‘ë ¬ë¡œ ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ ì œê³µ
- Paritionì´ í•˜ë‚˜ë¼ë©´ Sparkì— ìˆ˜ì²œ ê°œì˜ executorê°€ ìˆë”ë¼ë„ ë³‘ë ¬ì„±ì€ 1
- ìˆ˜ë°± ê°œì˜ Paritionì´ ìˆë”ë¼ë„ executorê°€ í•˜ë‚˜ ë°–ì— ì—†ë‹¤ë©´ ë³‘ë ¬ì„±ì€ 1
- Input Parition
- Output Parition
- Shuffle Parition

### â­íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜

- ë¶ˆë³€ì„± â‡’ í•œë²ˆ ìƒì„±í•˜ë©´ ë³€ê²½ ë¶ˆê°€
- dfë¥¼ ë³€ê²½í•˜ë ¤ë©´ ì›í•˜ëŠ” ë³€ê²½ ë°©ë²•ì„ ìŠ¤íŒŒí¬ì— ì•Œë ¤ì¤˜ì•¼í•¨
- ì¦‰ì‹œ ì‹¤í–‰ë˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ê³„ë³´ë¼ ë¶ˆë¦¬ëŠ” í˜•íƒœë¡œ ê¸°ë¡
    - ìµœì ì˜ ë£¨íŠ¸ë¥¼ ì°¾ëŠ”ë‹¤
- ì§€ì—°ì—°ì‚° (lazy evaluation)
    - í•˜ë‚˜ì˜ ì•¡ì…˜ì€ ëª¨ë“  ê¸°ë…ëœ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ì˜ ì§€ì—°ì—°ì‚° ë°œë™
    - Sparkê°€ ì—°ì‚° ê·¸ë˜í”„ë¥¼ ì²˜ë¦¬í•˜ê¸° ì§ì „ê¹Œì§€ ê¸°ë‹¤ë¦¬ëŠ” ë™ì‘ ë°©ì‹
    - ì „ì²´ ë°ì´í„° íë¦„ì„ ìµœì í™” í•˜ëŠ” ì—„ì²­ë‚œ ê°•ì 
        - Sparkê°€ íŠ¹ì • ì—°ì‚° ëª…ë ¹ì–´ ë‚´ë ¤ì§„ ì¦‰ì‹œ ë°ì´í„°ë¥¼ ìˆ˜ì •í•˜ì§€ ì•Šê³  ì›ì‹œ ë°ì´í„°ì— ì ìš©í•  íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ì˜ ì‹¤í–‰ ê³„íšì„ ìƒì„±
        - SparkëŠ” ì½”ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë§ˆì§€ë§‰ ìˆœê°„ê¹Œì§€ ëŒ€ê¸°í•˜ë‹¤ê°€ ì›í˜• DataFrame íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ì„ ê°„ê²½í•œ ë¬¼ë¦¬ì  ì‹¤í–‰ ê³„íšìœ¼ë¡œ ì»´íŒŒì¼
- ì§€ì—°í‰ê°€
    - ì•¡ì…˜ì´ ì‹¤í–‰ë˜ëŠ” ì‹œì ì´ë‚˜ ë°ì´í„°ì— ì‹¤ì œ ì ‘ê·¼í•˜ëŠ” ì‹œì ê¹Œì§€ ì‹¤ì œ ì‹¤í–‰ì„ ë¯¸ë£¨ëŠ” ìŠ¤íŒŒí¬ ì „ëµ

### ì¢ì€ ì˜ì¡´ì„±

- filter (where, having)
- íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ì€ í•˜ë‚˜ì˜ Input Paritionì´ í•˜ë‚˜ì˜ Output Paritionì—ë§Œ ì˜í–¥ì„ ë¯¸ì¹¨

### ë„“ì€ ì˜ì¡´ì„±

- group by, order byëŠ” ë„“ì€ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜
- íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ì€ í•˜ë‚˜ì˜ Input Paritionì´ ì—¬ëŸ¬ Outpu Paritionì— ì˜í–¥ì„ ë¯¸ì¹¨
- ì¢ì€ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ Sparkì—ì„œ íŒŒì´í”„ë¼ì´ë‹ì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰
    - DataFrameì— ì—¬ëŸ¬ í•„í„°ë¥¼ ì§€ì •í•˜ëŠ” ê²½ìš° ëª¨ë“  ì‘ì—…ì´ ë©”ëª¨ë¦¬ì—ì„œ ë°œìƒ

### â­****Shuffle****

- Sparkê°€ í´ëŸ¬ìŠ¤í„°ì—ì„œ Paritionì„ êµí™˜í•˜ëŠ” ì‘ì—…
- ì¢ì€ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ì„ ì‚¬ìš©í•˜ë©´ Sparkì—ì„œ íŒŒì´í”„ë¼ì´ë‹ì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰
    - DataFrameì— ì—¬ëŸ¬ í•„í„°ë¥¼ ì§€ì •í•˜ëŠ” ê²½ìš° ëª¨ë“  ì‘ì—…ì´ ë©”ëª¨ë¦¬ì—ì„œ ë°œìƒ
- ì…”í”Œì€ ê²°ê³¼ë¥¼ ë””ìŠ¤í¬ì— ì €ì¥í•¨

### â­Action

- ì¼ë ¨ì˜ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ìœ¼ë¡œë¶€í„° ê²°ê³¼ë¥¼ ê³„ì‚°í•˜ë„ë¡ ì§€ì‹œí•˜ëŠ” ëª…ë ¹
- ì•¡ì…˜ì„ ì§€ì •í•˜ë©´ Spark Jobì´ ì‹œì‘
- Spark Jobì€ filter(ì¢ì€ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜)ë¥¼ ìˆ˜í–‰í•œ í›„ Partitionë³„ë¡œ ë ˆì½”ë“œ ìˆ˜ë¥¼ ì¹´ìš´íŠ¸(ë„“ì€ íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜) í•œë‹¤.
- ê° ì–¸ì–´ì— ì í•©í•œ ë„¤ì´í‹°ë¸Œ ê°ì²´ì— ê²°ê³¼ë¥¼ ëª¨ì€ë‹¤.
- íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜ì„ ì‚¬ìš©í•´ ë…¼ë¦¬ì  ì‹¤í–‰ ê³„íšì„ ì„¸ìš¸ ìˆ˜ ìˆë‹¤.
- ì‹¤ì œ ì—°ì‚°ì„ ìˆ˜í–‰í•˜ë ¤ë©´ ì•¡ì…˜ ëª…ë ¹ì„ ë‚´ë ¤ì•¼ í•œë‹¤.

---

### ìŠ¤íŒŒí¬ ì„¤ì¹˜

- í™ˆí˜ì´ì§€ ì ‘ì†
- Download ë§í¬ ë³µì‚¬
    - Spark version : 3.3.4
    - Package : Pre-built for Apache Hadrrop 3.3 and later
        
        ```bash
        # client
        wget https://dlcdn.apache.org/spark/spark-3.3.4/spark-3.3.4-bin-hadoop3.tgz
        ```
        
    - ì••ì¶• í’€ê¸°
        
        ```bash
        tar xvzf ./spark-3.3.4/spark-3.3.4-bin-hadoop3.tgz
        ```
        
    - í´ë”ëª… ë³€ê²½
        
        ```bash
        mv spark-3.3.4-bin-hadoop3 ./spark
        ```
        
    - conf í´ë”ì— ë°ì´í„° ì˜®ê¸°ê¸°
        
        ```bash
        # 1. filezilla
        # 2. scp ëª…ë ¹ì–´
        # íŒŒì¼ ëª©ë¡
        - slaves
        - spark-default.conf
        - spark-env.sh
        ```
        
    - bashrc ì ìš© â†’ source ~/.bashrc
        
        ```bash
        export SPARK_HOME=/home/hadoop/spark
        export PATH=$PATH:$HADOOP_HOME/sbin:$HADOOP_HOME/bin:$HIVE_HOME/bin:$HIV    E_HOME/bin:$SQOOP_HOME/bin:$SPARK_HOME/bin
        ```
        

### Spark ì‹¤í–‰

- pyspark (ë‹¨ì¼ì‹¤í–‰)
    
    ![3](./img/spark1.png)
    
- Spark UI
    - IP:4040
- pyspark --master yarn --num-executors 3
    - sparkë¥¼ ë„ìš¸ ê±´ë° ì¼ê¾¼ 3ëª…ì´ì•¼
    - error
        - /etc/hosts ì—ì„œ 127.0.1.1 ì œê±°
    - ì¬ì‹œì‘
        - êµ‰ì¥íˆ ëŠë¦¬ê¸° ë•Œë¬¸ì— ê¸°ë‹¤ë ¤ì•¼ í•œë‹¤.
    - jupyter ì£¼ì†Œ ë“¤ì–´ê°€ê¸°
    - íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ sc ì‹¤í–‰
        - Spark UI ê°€ ë‚˜ì˜¤ë©´ ë“¤ì–´ê°€ì„œ í™•ì¸
- jupyter ì—°ë™
    - jupyter notebook --generate-config
    - vim /home/hadoop/.jupyter/jupyter_notebook_config.py
        
        ```bash
        # password -> 123
        c.NotebookApp.allow_origin = '*'
        c.NotebookApp.open_browser = False
        c.NotebookApp.password = "argon2:$argon2id$v=19$m=10240,t=10,p=8$JjOUUl+PkMyaeVWz34kP7g$gH7h20sz6D/JmgVtCUKm3RquEAcdCnbDQ4jRL2eFskI"
        ```
        
    - vim ~/.bashrc
        
        ```bash
        export PYSPARK_DRIVER_PYTHON=jupyter
        export PYSPARK_DRIVER_PYTHON_OPTS='notebook --ip=0.0.0.0'
        ```
        

### spark Environment

- spark.scheduler.mode : FIFO â‡’ Queue
- functional programing ë°©ì‹ (FP)
    - ê°ì²´ì—ì„œ ì ì„ ì°ê³  í•¨ìˆ˜ í˜¸ì¶œí•´ì„œ í•¨ìˆ˜í•œí…Œ ê²°ê³¼ë¥¼ ë°›ëŠ”ë‹¤.
    - í•¨ìˆ˜ë¥¼ ë‹¤ import ì‹œì¼œì„œ ì‚¬ìš©í•´ì•¼ í•œë‹¤.
- DAG (Directed Acyclic Graph)
    - ë¹„ìˆœí™˜ ê·¸ë˜í”„
- sort : íŠ¸ëœìŠ¤í¬ë©”ì´ì…˜
- take : action
- parquet : ë¹…ë°ì´í„° ì €ì¥

### git ë°ì´í„° ë°›ì•„ì™€ì„œ hadoopì— ë„£ê¸°

- ì„œë²„ì— gitì´ ì—†ëŠ” ê²½ìš°
    - sudo apt install git
- gitì—ì„œ ë°ì´í„° ë°›ì•„ì˜¤ê¸°
    - git clone https://github.com/FVBros/Spark-The-Definitive-Guide.git
- ì••ì¶• í’€ê¸°
    - tar xvfz {ì••ì¶•íŒŒì¼}
- ë°›ì€ ë°ì´í„°ì˜ csv íŒŒì¼ì„ hadoopì— ë„£ê¸°
    - cd {ì••ì¶•í‘¼ í´ë”}/data/flight-data/csv
    - hadoopì— í´ë” ë§Œë“¤ê³  ë°ì´í„° ë„£ê¸°
        - hdfs dfs -mkdir -p /data/flight
        - hdfs dfs -put *.csv /data/flight/

---

### hadoopì— ì¶”ê°€ ë°ì´í„° ë„£ê¸°

- cd {ì••ì¶•í‘¼ í´ë”}/data/flight-data/json
- hadoopì— í´ë” ë§Œë“¤ê³  ë°ì´í„° ë„£ê¸°
    - hdfs dfs -mkdir /data/flight/json
    - hdfs dfs -put *.json /data/flight/json

### ìŠ¤í‚¤ë§ˆ

- DBì—ì„œì˜ ìŠ¤í‚¤ë§ˆì˜ ê°œë…ì€ ë™ì¼
    - DataFrameì˜ ì»¬ëŸ¼ëª…ê³¼ ë°ì´í„° íƒ€ì…ì„ ì •ì˜
- ETL(ì¶”ì¶œ, ë³€í™˜, ì ì¬) ì‘ì—…ì— ìŠ¤íŒŒí¬ë¥¼ ì‚¬ìš©í•œë‹¤ë©´ ì§ì ‘ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•´ì•¼í•¨

### Apache Zeppelin

- í•˜ë‘¡ì˜ ì—ì½” ì‹œìŠ¤í…œ
- ë°ì´í„°ë¥¼ ë…¸íŠ¸ë¶ ê¸°ë°˜ìœ¼ë¡œ interactiveí•˜ê²Œ ë°ì´í„° ë¶„ì„ì„ í•  ìˆ˜ ìˆê²Œ ë„ì™€ì£¼ëŠ” í”„ë¡œê·¸ë¨

---

- ìŠ¤íŒŒí¬ëŠ” í•¨ìˆ˜ê°€ ë‹¤ ë¶„ì‚°ë˜ì–´ ìˆë‹¤.
- í‘œí˜„ì‹
    - expr : ê°„ë‹¨í•˜ê²Œ ì‚¬ìš© ê°€ëŠ¥
- spark ë‚´ ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì— í•¨ìˆ˜ëª…ì€ ìœ ì¼í•˜ë‹¤.
    - ë™ì¼ í•¨ìˆ˜ëª…ì„ ì„¤ì •í•˜ë©´ ê¸°ì¡´ì˜ í•¨ìˆ˜ ê¸°ëŠ¥ì€ ì‹¤í–‰ ë¶ˆê°€
    - ë§ˆì§€ë§‰ í•¨ìˆ˜ëª…, í•¨ìˆ˜ ê¸°ëŠ¥ìœ¼ë¡œ ì‹¤í–‰ë¨
- ê° ì»¬ëŸ¼ë³„ ê²°ì¸¡ì¹˜ í™•ì¸
    
    ```bash
    # ì‚¬ìš©ìê°€ ìš”ì²­ => ì•„ë˜ ì½”ë“œëŠ” ì‹¤í–‰ ê³„íšë§Œ ì¡í˜
    # show()í•˜ë©´ ìŠ¤í…Œì´ì§€ê°€ ëœ¨ê³  ë™ì‘ì„ í•œë‹¤.
    df2 = df.select([count(when(col(c).contains('None') | \
                        col(c).contains('NULL') | \
                        (col(c) == '' ) | \
                        col(c).isNull(), c
                        )).alias(c)
                        for c in df.columns])
    ```
    
    ```bash
    
    df = df.withColumn('ì„±ë³„', when(col('ì„±ë³„') == 'm', 'M').otherwise(col('ì„±ë³„')))
    
    df.groupby("ì„±ë³„").agg( count("ì„±ë³„").alias("ê°’")).show()
    ```
    
- printschema()
    - í…Œì´ë¸” ì •ë³´ ì¶œë ¥ : ì»¬ëŸ¬ëª…, ë°ì´í„° íƒ€ì…

---

### Error

- ë‚˜ì˜ í™˜ê²½
    - ë…¸íŠ¸ë¶ 4ëŒ€ (client, namenode, secondnode, datanode3)
    - jupyerë¥¼ ì´ìš©í•´ì„œ ë‚´ ë…¸íŠ¸ë¶ì—ì„œ spark í‚¤ë ¤ í• ë•Œ timeoutë‚˜ëŠ” ìƒí™©ì´ ê³„ì† ë°œìƒ
        - ë…¸íŠ¸ë¶ê³¼ Sparkì˜ í†µì‹ ìœ¼ë¡œ ì¸í•œ ì˜¤ë¥˜
        - ë¡œì»¬ì´ ì•„ë‹Œ ê° ë…¸íŠ¸ë¶ í™˜ê²½ì´ë¼ì„œ ì‹œê°„ëŒ€ê°€ ë‹¤ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆì„ ê°€ëŠ¥ì„±ì´ ì¡´ì¬
- jupyter í™˜ê²½ì„ ì œê±° í•œ í›„ ì‹¤í–‰í•˜ì
    - ë¦¬ëˆ…ìŠ¤ í™˜ê²°ì„¤ì • ì‚­ì œ
        
        ```bash
        # í™˜ê²½ë³€ìˆ˜ í™•ì¸
        env
        env | grep í™˜ê²½ë³€ìˆ˜ëª…
        
        # í™˜ê²½ë³€ìˆ˜ í•´ì œ
        unset í™˜ê²½ë³€ìˆ˜ëª…
        ```
        
    - CLI í™˜ê²½ì—ì„œ ì‘ì—…í•´ì•¼í•¨

### Error - jupyter ì‚¬ìš© ê°€ëŠ¥í•˜ê²Œ ìˆ˜ì •

- ì„œë²„ì—ì„œ jupyter ì‹¤í–‰
- jupyterì—ì„œ Spark ì‹¤í–‰
    
    ```python
    import findspark
    findspark.init()
    
    from pyspark.sql import SparkSession
    # SparkSessionì„ ìƒì„±í•˜ë©´ì„œ í•„ìš”í•œ ì„¤ì •ì„ ì§€ì •
    spark = SparkSession.builder \
        .appName("example") \
        .master("yarn") \
        .config("spark.executor.instances", 3) \
        .getOrCreate()
    ```
    
    ```python
    # csv íŒŒì¼ì„ ë¶ˆëŸ¬ì™€ Dataframeìœ¼ë¡œ ë§Œë“ ë‹¤
    df = spark.read.csv("/data/bicycle/*", encoding='cp949', inferSchema = True, header=True)
    ```

</br>

### ğŸ’¡ Reference


- Spark
    - https://spark.apache.org/
    - [https://minsw.github.io/2021/01/20/Spark-The-Definitive-Guide-1ì¥/](https://minsw.github.io/2021/01/20/Spark-The-Definitive-Guide-1%EC%9E%A5/)
- Spark ê°œë…
    - [https://velog.io/@jskim/Spark-ì„¤ì¹˜-ë°-ì‹¤í–‰í•˜ê¸°-Local-Mode](https://velog.io/@jskim/Spark-%EC%84%A4%EC%B9%98-%EB%B0%8F-%EC%8B%A4%ED%96%89%ED%95%98%EA%B8%B0-Local-Mode)
    - [https://velog.io/@jskim/Spark-ë°°í¬-ë°-ì‹¤í–‰-ë°©ë²•ì—-ëŒ€í•œ-ì´í•´](https://velog.io/@jskim/Spark-%EB%B0%B0%ED%8F%AC-%EB%B0%8F-%EC%8B%A4%ED%96%89-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%8C%80%ED%95%9C-%EC%9D%B4%ED%95%B4)
- spark RDD ì´í•´í•˜ê¸°
    - https://bomwo.cc/posts/spark-rdd/
- Partition /  Shuffle
    - https://spidyweb.tistory.com/312
    - https://firststep-de.tistory.com/54
- OLTP /   OLAP
    - https://too612.tistory.com/511
- Linux í™˜ê²½ë³€ìˆ˜ í™•ì¸
    - https://www.leafcats.com/201
    - https://blog.naver.com/PostView.naver?blogId=pmw9440&logNo=223070863428